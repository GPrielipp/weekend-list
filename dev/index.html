<!DOCTYPE html>

<!-- Main webpage -->
<html lang="en">
	<!-- Headers for the webpage -->
	<head>
		<!-- Bootstrap CSS and JS files - version 5.3.3 -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

		<meta charset="utf-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1"
		/>
		<link
			rel="stylesheet"
			href="style.css"
		/>
		<title>22nd Company Homepage</title>

    <!-- scripts for the main webpage -->
    <script src="weekend-form.js"></script>
    <script src="index.js"></script>
	</head>
  
	<!-- body of the webpage -->
	<body>
    <nav class="navbar navbar-expand-sm navbar-dark bg-dark sticky-top">
      <div
      class="container-fluid"
      id="navbarText"
			>
      <ul
      class="navbar-nav me-auto"
      id="navbar"
      >
      <li class="nav-item me-3">
        <button
        href="#"
        class="btn btn-outline-primary"
        id="home"
        >
        Home
      </button>
    </li>
  </ul>
</div>
</nav>

<!-- main content for the page -->
<div
class="container"
id="content"
>
<p>Page loaded</p>
<button id="clickme">CLICK ME</button>
</div>

	</body>
	<script>
		const app = document.getElementById("clickme");

		app.addEventListener('click', (el, ev) => {
			console.log('Fetching data');

			fetch('api/query.php', {
				method: 'POST', 
				headers: {'Content-Type': 'application/json'}, 
				body: JSON.stringify({
					action: 'querySquad', 
					COMPANY: 22, 
					PLATOON: 4,
					SQUAD: 3,
					LAST: 'Prielipp', 
			})})
			.then(resp => {
				console.log(resp.body);
				if (resp.status == 200) return resp.json();
			})
			// .then(blob => blob.text())
			.then(data => {
				console.log(data.results);
				const page = document.getElementById('content');
				page.childNodes = [];
				data.results.forEach( obj => {
					const row = document.createElement('div');
					console.log(obj);
					row.innerText = `${obj.LAST_NAME}, ${obj.FIRST_NAME} ${obj.PLATOON}-${obj.SQUAD} ${obj.WEEKEND_COUNT}`;
					page.appendChild(row);
				});
			})
		});

	</script>
</html>
